---
import { workTimer } from '../stores/timer';
import { showSessions } from '../stores/sessions';
---

<div
    id="settings-modal"
    class="fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center
           transition-all z-50 opacity-0 pointer-events-none"
>
    <div
        class="bg-white border-2 border-neutral-900 shadow-[8px_8px_0_#000] rounded-2xl p-8 w-[90%] max-w-md"
    >
        <h2 class="manrope-font font-black text-2xl mb-4">Settings</h2>

        <div class="flex flex-col gap-4 manrope-font">
            <div class="flex justify-between items-center">
                <span class="font-semibold">Work Duration</span>
                <input
                    id="work-duration"
                    type="number"
                    min="1"
                    max="60"
                    class="border-2 border-neutral-900 rounded px-3 py-1 w-20 shadow-[3px_3px_0_#000]"
                    value={workTimer.get() / 60}
                />
            </div>

            <div class="flex justify-between items-center">
                <span class="font-semibold">Break Duration</span>
                <input
                    type="number"
                    min="1"
                    max="30"
                    class="border-2 border-neutral-900 rounded px-3 py-1 w-20 shadow-[3px_3px_0_#000]"
                />
            </div>

            <div class="flex justify-between items-center">
                <span class="font-semibold">Sessions</span>
                <input
                    id="sessions"
                    type="number"
                    min="1"
                    max="10"
                    class="border-2 border-neutral-900 rounded px-3 py-1 w-20 shadow-[3px_3px_0_#000]"
                    value={showSessions()}
                />
            </div>
        </div>

        <button
            id="closeSettings"
            class="mt-6 px-4 py-2 bg-neutral-900 text-white manrope-font rounded-full border-2 border-neutral-900
             shadow-[4px_4px_0_#000] hover:shadow-[2px_2px_0_#000] active:shadow-none
             active:translate-x-1 active:translate-y-1 transition-all cursor-pointer"
        >
            Close
        </button>
    </div>
</div>

<script>
    import { showSettings, toggleSettings } from '../stores/navbar_toggle';
    import { updateTimer, workTimer } from '../stores/timer';
    import { sessions, updateSessions } from '../stores/sessions';

    const modal = document.getElementById('settings-modal');
    const closemodal = document.getElementById('closeSettings');
    const work = document.getElementById(
        'work-duration'
    ) as HTMLInputElement | null;
    const sessionsInput = document.getElementById(
        'sessions'
    ) as HTMLInputElement | null;
    closemodal?.addEventListener('click', toggleSettings);

    showSettings.subscribe((isOpen) => {
        if (isOpen) {
            modal?.classList.remove('opacity-0', 'pointer-events-none');
            modal?.classList.add('opacity-100', 'pointer-events-auto');

            if (work) work.value = (workTimer.get() / 60).toString();
            if (sessionsInput) sessionsInput.value = sessions.get().toString();
        } else {
            modal?.classList.add('opacity-0', 'pointer-events-none');
            modal?.classList.remove('opacity-100', 'pointer-events-auto');
        }
    });

    work?.addEventListener('change', (e: any) => {
        const target = e.target;
        if (target instanceof HTMLInputElement)
            updateTimer(Number(target.value));
    });

    sessionsInput?.addEventListener('change', (e: any) => {
        const target = e.target;
        if (target instanceof HTMLInputElement)
            updateSessions(Number(target.value));
    });
</script>
